<%@page import="java.sql.ResultSetMetaData"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.Statement"%>
<%@page import="java.sql.DriverManager"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=EUC-KR"
	pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
<link rel="stylesheet" href="../css/main.css" />
<style>
textarea {
	width: 100%;
	height: 200px;
	padding: 10px;
	box-sizing: border-box;
	border: solid 2px #1E90FF;
	border-radius: 5px;
	font-size: 16px;
	resize: both;
}
</style>

</head>
<body>
<%
request.setCharacterEncoding("utf-8");
String sql = request.getParameter("inputquery");
%>
	<form action="jdbcTest.jsp" method="post" name="f">
		<textarea name="inputquery"><%=(sql == null) ? "" : sql %></textarea>
		<input type="submit" value="실행" />
	</form>
	<%
	Connection conn = null;
	if(sql != null && sql.trim().equals("")){
		try{
			//드라이버 설정
			Class.forName("org.mariadb.jdbc.Driver");
			//연결객체(Connection 객체)
			Connection conn = DriverManager.getConnection("jdbc:mariadb://localhost:3306/classdb", "root", "1234");
			//PreparedStatement : Statement 하위 인터페이스, sql 구문을 미리 db 서버에 전송
			PreparedStatement pstmt = conn.prepareStatement(sql);
			ResultSet rs = pstmt.executeQuery();
			Statement stmt = conn.createStatement();
			ResultSet rs = stmt.executeQuery(sql);
			ResultSetMetaData rsmt = rs.getMetaData();
			conn.prepareStatement("select count(*) from ("+ sql + ") a");
			ResultSet rs2 = pstmt2.executeQuery();
			rs2.next();
			int cnt = rs2.getInt(1); // 조회된 레코드의 건수
			%>
			<table><caption><%= sql %></caption>
				<tr>
					<%
						for (int i = 1; i <= rsmt.getColumnCount(); i++) { count++;
					%>
					<th><%=rsmt.getColumnName(i)%></th>
					<%
						}
					%>
				
				<tr>
					<%
						while (rs.next()) {
					%>
				
				<tr>
					<%
						for (int i = 1; i < rsmt.getColumnCount(); i++) {
					%>
					<td><%=rs.getString(i)%></td>
					<%
						}
					%>
					<%
						}
					%>
				
			</table><%
		}
	}
	%>
	<div id="dbarea"></div>
</body>
</html>