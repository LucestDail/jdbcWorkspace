<%@page import="model.Member"%>
<%@page import="model.MemberDao"%>
<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<%-- 
1. 모든 파라매터 정보를 Member 객체에 저장 => useBean 태그
2. 입력된 비밀번호와 데이터베이스에 저장된 비밀번호 비교
-> 같지 않은 경우 : "비밀번호 오류" 메시지 출력, updateForm.jsp 페이지 이동
3. 파라매터를 저장하고 있는 Member 객체를 이용하여 데이터베이스 정보 수정
int MemberDao.update(Member)
결과가 0 이하면 수정실패 메시지 출력후 updateForm.jsp 페이지 이동
1 이상이면 수정 성공 => info.jsp 페이지로 이동
 --%>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
</head>
<body>
<%request.setCharacterEncoding("euc-kr");%>
<jsp:useBean id = "mem" class = "model.Member"/>
<%-- 1. 모든 파라매터 정보를 Member 객체에 저장 --%>
<jsp:setProperty property = "*" name = "mem"/>
<%
String sessionId = (String)session.getAttribute("id");
MemberDao dao = new MemberDao();
Member dbMem = dao.selectOne(sessionId);
String msg = null;
String url = null;
int result = 0;
// 입력된 비밀번호와 데이터베이스에 저장된 비밀번호를 비교
if(!(dbMem.getPass().equals(mem.getPass()))){
	// -> 같지 않은 경우 : "비밀번호 오류" 메시지 출력, updateForm.jsp 페이지로 이동
	msg = "비밀번호 오류 실패";
	url = "updateForm.jsp";
}else{
	//dao.update 통하여 성공하면 양수, 실패시 0, 음수 반환
	// 파라매터를 저장하고 있는 Member 객체를 이용하여 데이터베이스 정보 수정
	result = dao.update(mem);
	if(result > 0){
		// 결과가 1 이상이면 수정 성공 =. info.jsp 페이지로 이동
		msg = mem.getName() + "님 회원정보 수정 완료";
		url = "info.jsp";
	}else{
		// 결과가 0 이하면 수정 실패 메시지 출력 후 updateForm.jsp 페이지 이동
		msg = mem.getName() + "님 회원정보 수정 실패";
		url = "updateForm.jsp";
	}
}
%>
<script>
	alert("<%=msg%>");
	location.href = "<%=url%>";

</script>
</body>
</html>